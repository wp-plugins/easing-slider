(function(a){window.Slide=Backbone.Model.extend({defaults:{url:null,sizes:null,alt:null,title:null,link:null,linkTarget:"_blank",},});window.SlideCollection=Backbone.Collection.extend({model:Slide,primary:0,initialize:function(){var b=this;this.on("add",this.addModel,this);this.on("remove",this.removeModel,this);this.on("reset",this.resetData,this);this.on("change",this.resetData,this);setTimeout(function(){_.each(b.models,function(c){b.primary++})})},addModel:function(b){this.primary++;b.set({id:this.primary},{silent:true});this.reset(this.models,{silent:true});this.resetData()},removeModel:function(){var b=this;this.resetIDs();this.reset(this.models,{silent:true});this.resetData()},resetData:function(){a("#slideshow-images").val(JSON.stringify(this))},resetIDs:function(){var b=this;this.primary=0;_.each(this.models,function(c){b.primary++;c.set({id:b.primary},{silent:true})});return this},});window.SlideView=wp.media.View.extend({$container:a(".thumbnails-container .inner"),template:wp.media.template("slide"),initialize:function(){var b=this;this.collection.on("add",this.addThumb,this);this.collection.on("remove",this.render,this);this.collection.on("reset",this.render,this);this.collection.on("change:url",this.render,this);a(".delete-images").bind("click",function(c){c.preventDefault();if(confirm(easingsliderlite.delete_images)){b.removeThumbs.call(b,c)}});a(".add-image").bind("click",function(c){c.preventDefault();addImageView.render()});a(document).delegate(".delete-button","click",function(c){c.preventDefault();if(confirm(easingsliderlite.delete_image)){b.collection.remove(b.collection.get(a(this).parent().attr("data-id")))}});a(document).delegate(".thumbnails-container img","click",function(c){c.preventDefault();var e=a(this).parent().attr("data-id"),d=new EditSlideView({model:b.collection.get(e)});a(d.render().el).appendTo("body").focus()})},addThumb:function(b){this.$container.append(this.template(b.toJSON()))},removeThumbs:function(b){b.preventDefault();this.$container.empty();this.collection.reset();this.collection.primary=0},render:function(){var b=this;this.$container.empty();_.each(this.collection.models,function(c){b.$container.append(b.template(c.toJSON()))});return this}});window.EditSlideView=wp.media.View.extend({attributes:{tabindex:0},changeImageView:null,template:wp.media.template("edit-slide"),events:{change:"change","click .media-modal-backdrop, .media-modal-close":"discardChanges","click .change-image":"changeImage","click .media-modal-save":"close","click .media-menu-item":"toggleTab",keydown:"keyDown"},initialize:function(){this.origAttributes=_.clone(this.model.attributes);this.model.on("change:url",this.resetThumbnail,this)},toggleTab:function(b){b.preventDefault();var c=b.target.dataset.tab;a(".media-menu-item").removeClass("active");a(b.target).addClass("active");a(".media-tab",this.$el).each(function(){if(this.id===c){a(this).show()}else{a(this).hide()}})},close:function(b){b.preventDefault();this.remove();if(this.changeImageView){this.changeImageView.remove()}},change:function(b){var c=b.target,d={};d[c.id]=c.value;this.model.set(d)},discardChanges:function(c){c.preventDefault();var d=JSON.stringify(this.model.attributes),b=JSON.stringify(this.origAttributes);if(d===b){this.close(c)}else{if(confirm(easingsliderlite.media_upload.discard_changes)){this.model.set(this.origAttributes);this.close(c)}}},resetThumbnail:function(b,e){var d=b.get("sizes"),c=d.large||d.medium||d.thumbnail;this.$(".slide-thumbnail").attr("src",c.url)},changeImage:function(c){c.preventDefault();var b=this;if(this.changeImageView===null){this.changeImageView=new ChangeImageView({id:this.model.get("id"),model:this.model})}this.changeImageView.render();a(".media-modal-backdrop").first().hide();this.changeImageView.fileFrame.on("close",function(){a(".media-modal-backdrop").first().show();b.$el.focus()})},keyDown:function(b){if(b.keyCode===27){b.preventDefault();this.discardChanges(b);return}},render:function(){a(this.el).html(this.template(this.model.toJSON()));return this},});window.AddImageView=Backbone.View.extend({fileFrame:null,frameProperties:{title:easingsliderlite.media_upload.title,button:easingsliderlite.media_upload.button,multiple:true},modelAttributes:["url","sizes","alt","title"],initialize:function(){if(this.fileFrame){return}this.fileFrame=wp.media.frames.fileFrame=new wp.media({title:this.frameProperties.title,button:{text:this.frameProperties.button},multiple:this.frameProperties.multiple});this.fileFrame.on("select",this.onSelect,this)},onSelect:function(){var c=this.fileFrame.state().get("selection"),b=this;_.each(c.models,function(e){var f={};for(var d in b.modelAttributes){f[b.modelAttributes[d]]=e.get(b.modelAttributes[d])}b.collection.add([f])})},render:function(){this.fileFrame.open()}});window.ChangeImageView=AddImageView.extend({frameProperties:{title:easingsliderlite.media_upload.title,button:easingsliderlite.media_upload.change,multiple:false},onSelect:function(){var c=this.fileFrame.state().get("selection"),d=c.models[0],e={};
for(var b in this.modelAttributes){e[this.modelAttributes[b]]=d.get(this.modelAttributes[b])}this.model.set(e)},remove:function(){AddImageView.prototype.remove.apply(this,arguments);this.fileFrame.modal.$el.remove();this.fileFrame.uploader.$browser.remove()},});wp.media.view.Attachment.Details.prototype.template=wp.media.template("image-details");a(".sidebar-name").bind("click",function(){var c=a(this).parent(),b=c.find(".sidebar-content");if(!c.hasClass("exclude")){a(".sidebar-name").each(function(){var d=a(this).parent();if(!d.hasClass("exclude")&&!d.hasClass("closed")){d.find(".sidebar-content").slideUp(200,function(){d.addClass("closed")})}})}if(c.hasClass("closed")){b.slideDown(200,function(){c.removeClass("closed")})}else{b.slideUp(200,function(){c.addClass("closed")})}});a(".thumbnails-container").sortable({items:".thumbnail",containment:"parent",tolerance:"pointer",stop:function(d,e){var b=[],f=[];a(this).find(".thumbnail").each(function(){b.push(a(this).attr("data-id"))});for(var c=0;c<b.length;c++){f.push(slideCollection.get(b[c]))}slideCollection.reset(f).resetIDs().resetData()}});setTimeout(function(){a(".message").not(".permanent").each(function(){a(this).fadeOut(400,function(){a(this).remove()})})},5000);a(".warn").bind("click",function(){if(!confirm(easingsliderlite.warn)){return false}});if(a("#slideshow-images").length==0){return}window.slideCollection=new SlideCollection(JSON.parse(a("#slideshow-images").val()));window.slideView=new SlideView({collection:slideCollection});window.addImageView=new AddImageView({collection:slideCollection})})(jQuery);